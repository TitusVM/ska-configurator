# SKA Configurator - Work Log

## Status: COMPLETE

### Decisions (from user, 2026-02-13)
- Java 21, Swing GUI
- User-to-group: CSV import + manual GUI override
- Load existing SKA XML files + create new
- skamodify protection levels: configurable per operation
- Module name & key labels: free-text user input
- EC params: predefined curve list + raw PEM paste
- Cert change: on CSV import, diff vs loaded SKA, prompt to update stale certs

### 2026-02-13 - Initial Analysis
- Read README.md, example/ska.xml, exports/export.csv, pom.xml, App.java
- XML structure: skaconfig > {organization, skaplus, skamodify, keys>proto, users}
- Operations: use, modify, block, unblock — each with boundaries>groups>members
- CSV: 32+ cols (cn, cert, Email, Organisation, userId, role cols like Org Owner/SecOff/Op)

---
## IMPLEMENTATION PLAN (step by step)

### Phase 1: Project setup
- [x] 1.1 Update pom.xml (Java 21, OpenCSV 5.9, FlatLaf 3.4, JUnit 4.13.2, maven-shade for fat JAR)
- [x] 1.2 Clean up App.java (FlatLaf L&F, basic JFrame launch)
- [x] 1.3 Build verified (mvn clean package), JAR runs OK

### Phase 2: Data model
- [x] 2.1 SkaConfig (root), SkaSection (org/skaplus/skamodify), KeysProto
- [x] 2.2 Operations, Operation, Boundary, Group
- [x] 2.3 User, EcParameters
- [x] 2.4 Build verified — all 9 model classes compile

### Phase 3: CSV import
- [x] 3.1 Added role fields (orgOwnerOf/orgSecOffOf/orgOpOf) to User model
- [x] 3.2 CsvImporter: OpenCSV RFC4180 parser, header-based column mapping
- [x] 3.3 Handles: multiline PEM certs, &nbsp; cleanup, cert in wrong column, || multi-values
- [x] 3.4 Deduplication by CN (merges data, keeps latest cert, unions roles)
- [x] 3.5 CsvImporterTest: 5 tests pass (real CSV import, cert cleaning, multi-value parsing)

### Phase 4: XML read/write
- [x] 4.1 SkaXmlReader: DOM parser, reads all sections/operations/boundaries/groups/users
- [x] 4.2 SkaXmlWriter: DOM builder, indented output, CDATA for certs, curveName attr
- [x] 4.3 Security: external entities disabled in reader
- [x] 4.4 SkaXmlReaderWriterTest: 2 tests (full read + round-trip), all 8 tests pass

### Phase 5: Swing GUI — main frame & navigation
- [x] 5.1 MainFrame: menu bar (New/Open/Save/SaveAs/Import CSV/Exit), keyboard shortcuts
- [x] 5.2 GlobalConfigPanel: moduleName, version, per-section key labels + validity + blockedOnInit
- [x] 5.3 File ops: open XML, save XML, CSV import with cert-change detection + new-user prompt
- [x] 5.4 Status bar, bidirectional model↔UI sync (loadFrom/saveTo)
- [x] 5.5 App.java wired to MainFrame, build + smoke test OK

### Phase 6: Swing GUI — section panels
- [x] 6.1 EcParametersPanel: curve combo (predefined + free text) + PEM text area
- [x] 6.2 OperationPanel: delay/timeLimit spinners, boundary list, group list, group detail
       — group detail: name, quorum, members/keys radio, add/remove members, Apply button
       — deep-copy boundaries for safe editing, confirmation on destructive ops
- [x] 6.3 SectionPanel (org/skaplus/skamodify): EC params + 4 operation sub-tabs
- [x] 6.4 KeysProtoPanel: same layout without key metadata
- [x] 6.5 MainFrame wired: 5 tabs (Global Config, Organization, SKA Plus, SKA Modify, Keys Proto)
- [x] 6.6 Build + smoke test OK

### Phase 7: Swing GUI — user management
- [x] 7.1 UsersPanel: JTable (CN, Name, Email, Organisation, UserID, Cert ✓/—), add/edit/remove/view cert buttons
- [x] 7.2 UserEditDialog: modal form for add/edit user (CN required, name, email, org, userId, cert PEM)
- [x] 7.3 UserPickerDialog: multi-select modal to pick users by CN for group membership
- [x] 7.4 OperationPanel: "Pick from Users…" button, user supplier pattern, dedup on add
- [x] 7.5 SectionPanel/KeysProtoPanel: setUserListSupplier pass-through
- [x] 7.6 MainFrame: Users tab wired, user supplier connected to all section panels
- [x] 7.7 Build + all 8 tests pass

### Phase 8: Validation & polish
- [x] 8.1 Dirty flag: tracks unsaved changes, title bar shows `*` when dirty
- [x] 8.2 Unsaved-changes guard: New/Open prompt to discard; Exit prompts save/discard/cancel
- [x] 8.3 Window close intercept (DO_NOTHING_ON_CLOSE + WindowAdapter → doExit)
- [x] 8.4 Save validation warnings: missing module name, missing certs, empty groups, bad date formats
- [x] 8.5 GlobalConfigPanel: date format tooltips (YYYY-MM-DD), validateFields() method
- [x] 8.6 UserEditDialog: PEM format warning (BEGIN/END markers), duplicate CN check, Escape to close
- [x] 8.7 UserPickerDialog: Escape to close, null-safe return (empty list instead of null)
- [x] 8.8 UsersPanel: status bar feedback on add/edit/remove, dirty callback, auto-select new row
- [x] 8.9 Build + all 8 tests pass

### Phase 9: Build & packaging
- [x] 9.1 Fat JAR: maven-shade-plugin produces ska-configurator-1.0-SNAPSHOT.jar (3.5 MB, all deps bundled)
- [x] 9.2 Smoke test: JAR launches GUI correctly (`java -jar target/ska-configurator-1.0-SNAPSHOT.jar`)
- [x] 9.3 End-to-end integration test: XML read → CSV import → modify → save → re-read (EndToEndTest.java)
- [x] 9.4 All 9 tests pass (1 AppTest + 5 CsvImporter + 2 XmlReaderWriter + 1 EndToEnd)
- [x] 9.5 .gitignore updated (dependency-reduced-pom.xml, .idea/, *.iml)
- [x] 9.6 Final clean build: BUILD SUCCESS
